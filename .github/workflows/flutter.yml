# name: Flutter CI

# on: [push, pull_request]

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout repository
#       uses: actions/checkout@v3

#     - name: Set up Flutter
#       uses: subosito/flutter-action@v2
#       with:
#         flutter-version: '3.13.0'  # Update to a specific recent version of Flutter

#     - name: Install dependencies
#       run: flutter pub get

#     - name: Run tests
#       run: flutter test

#     - name: Build Web
#       run: flutter build web

#     - name: Deploy to GitHub Pages
#       uses: peaceiris/actions-gh-pages@v3
#       with:
#         github_token: ${{ secrets.GITHUB_TOKEN }}
#         publish_dir: build/web
name: Update Web Branch

on:
  push:
    branches:
      - main

jobs:
  update-web:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Main Branch
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.13.0'  # Ensure this version includes Dart SDK >= 3.0.0

    - name: Install Dependencies
      run: flutter pub get

    - name: Build Flutter Web
      run: flutter build web --release --no-tree-shake-icons

    - name: Fetch All Branches
      run: git fetch --all

    - name: Create or Checkout Web Branch
      run: |
        if git show-ref --verify --quiet refs/heads/web-branch; then
          git checkout web-branch
        else
          git checkout -b web-branch
        fi

    - name: Copy Built Files to Web Branch
      run: |
        rm -rf *  # clear the web branch directory
        cp -R build/web/* .
        git add .
        git commit -m "Update web branch with latest changes from main"
        git push origin web-branch

    - name: Deploy to GitHub Pages
      run: |
        git checkout -B gh-pages
        git add .
        git commit -m "Deploy to GitHub Pages"
        git push --force origin gh-pages
